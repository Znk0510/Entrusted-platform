{% extends "layout.html" %}

{% block title %}ç·¨è¼¯å€‹äººè³‡æ–™{% endblock %}

{% block content %}
<div class="auth-container-wide">
    <form method="POST" action="{{ url_for('handle_edit_profile') }}" enctype="multipart/form-data" class="profile-edit-card">
        
        <div class="profile-edit-sidebar">
            <h3 class="sidebar-title">å€‹äººé ­åƒ</h3>
            
            <div class="avatar-upload-container">
                <div class="avatar-preview-wrapper">
                    {% if user.avatar %}
                        <img id="avatar-preview-img" src="/{{ user.avatar }}" alt="Avatar Preview">
                    {% else %}
                        <div id="avatar-preview-placeholder" class="avatar-placeholder-large">
                            {{ user.username[0] | upper }}
                        </div>
                        <img id="avatar-preview-img" src="" style="display: none;">
                    {% endif %}
                    
                    <label for="avatar" class="avatar-upload-overlay">
                        <span class="camera-icon">ğŸ“·</span>
                        <span class="upload-text">æ›´æ›åœ–ç‰‡</span>
                    </label>
                </div>
            </div>

            <input type="file" id="avatar" name="avatar" accept="image/*" onchange="previewImage(this)">
            
            <p class="helper-text">å»ºè­°å°ºå¯¸: 500x500px</p>
        </div>

        <div class="profile-edit-main">
            <div class="form-header-group">
                <h2>ç·¨è¼¯å€‹äººè³‡æ–™</h2>
                <p>å®Œå–„æ‚¨çš„å€‹äººæª”æ¡ˆï¼Œè®“åˆä½œå¤¥ä¼´æ›´äº†è§£æ‚¨ã€‚</p>
            </div>

            <div class="form-group">
                <label for="introduction">è‡ªæˆ‘ä»‹ç´¹</label>
                <textarea id="introduction" name="introduction" rows="8" 
                          placeholder="å‘å¤§å®¶ä»‹ç´¹ä¸€ä¸‹ä½ è‡ªå·±&#10;ä¾‹å¦‚ï¼šæ‚¨çš„å°ˆæ¥­æŠ€èƒ½ã€éå¾€ç¶“é©—æˆ–æ¥æ¡ˆé¢¨æ ¼ ..."
                          class="styled-textarea">{{ user.introduction if user.introduction else '' }}</textarea>
                <p style="text-align: right; font-size: 0.85em; color: #aaa; margin-top: 5px;">
                    å±•ç¾æ‚¨çš„å°ˆæ¥­èˆ‡ç†±æƒ…
                </p>
            </div>

            <div class="action-buttons">
                <a href="{{ url_for('view_user_profile', user_id=user.id) }}" 
                    class="btn btn-secondary btn-lg" 
                    style="min-width: 150px; text-align: center;">
                    å–æ¶ˆä¸¦è¿”å›
                </a>

                <button type="submit" class="btn btn-primary btn-lg" style="min-width: 150px;">
                    å„²å­˜è®Šæ›´
                </button>
            </div>
        </div>

    </form>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                // éš±è—æ–‡å­— placeholder
                var placeholder = document.getElementById('avatar-preview-placeholder');
                if (placeholder) placeholder.style.display = 'none';
                
                // é¡¯ç¤º img æ¨™ç±¤ä¸¦è¨­å®š src
                var img = document.getElementById('avatar-preview-img');
                img.src = e.target.result;
                img.style.display = 'block';
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}