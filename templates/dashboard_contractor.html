{% extends "layout.html" %}

{% block title %}æ¥æ¡ˆäººå„€è¡¨æ¿{% endblock %}

{% block content %}
    <h2>æ‰¾æ¥æ¡ˆ</h2>
    <p>ä½ å¥½ï¼Œ{{ user.username }}ï¼æ­¡è¿å›ä¾†ã€‚</p>
    
    <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--border-color);">
    
    <div class="dashboard-grid">

        <div class="dashboard-main">

            <form class="sleek-search-bar" action="{{ url_for('get_contractor_dashboard') }}" method="GET">
                <div class="search-input-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" 
                           id="search" 
                           name="search" 
                           value="{{ search_query or '' }}" 
                           placeholder="Hi ä»Šå¤©æƒ³æ‰¾ä»€éº¼æ¡ˆä»¶å‘¢">
                </div>
                <button type="submit" class="btn-search">æœå°‹</button>
            </form>

            <div class="content-box">
                <h3>æŸ¥è©¢å§”è¨—å°ˆæ¡ˆ (æ‰€æœ‰é–‹æ”¾ä¸­çš„æ¡ˆå­)</h3>
                {% if open_projects %}
                    <table class="table-styled">
                        <thead>
                            <tr>
                                <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                                <th>å§”è¨—äºº</th>
                                <th>æè¿° (éƒ¨åˆ†)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in open_projects %}
                            <tr>
                                <td>{{ project.title }}</td>
                                <td>{{ project.client_name }}</td>
                                <td>{{ project.description[:100] }}...</td>
                                <td>
                                    <a href="{{ url_for('get_contractor_project_details', project_id=project.id) }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹è©³æƒ… & å ±åƒ¹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>
                        {% if search_query %}
                            æ‰¾ä¸åˆ°ç¬¦åˆ "{{ search_query }}" çš„é–‹æ”¾ä¸­å°ˆæ¡ˆã€‚
                        {% else %}
                            ç›®å‰æ²’æœ‰ä»»ä½•é–‹æ”¾ä¸­çš„å°ˆæ¡ˆã€‚
                        {% endif %}
                    </p>
                {% endif %}
            </div>

        </div> <div class="dashboard-sidebar">

            <div class="content-box">
                <h3>æˆ‘è´å¾—çš„æ¡ˆå­</h3>
                 {% if won_projects %}
                    <table class="table-styled">
                        <thead>
                            <tr>
                                <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                                <th>ç‹€æ…‹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in won_projects %}
                            <tr>
                                <td>{{ project.title }}</td>
                                <td>
                                    <strong>{{ project.status }}</strong>
                                    {% if project.status == 'in_progress' %}
                                        (é€²è¡Œä¸­)
                                    {% elif project.status == 'rejected' %}
                                        (å·²é€€ä»¶)
                                    {% elif project.status == 'pending_approval' %}
                                        (ç­‰å¾…é©—æ”¶)
                                    {% elif project.status == 'completed' %}
                                        (å·²çµæ¡ˆ)
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('get_contractor_project_details', project_id=project.id) }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>ä½ ç›®å‰æ²’æœ‰ä»»ä½•å·²å¾—æ¨™çš„å°ˆæ¡ˆã€‚</p>
                {% endif %}
            </div>

            <div class="content-box">
                <h3>æˆ‘æŠ•æ¨™çš„æ¡ˆå­ (å¯©æ ¸ä¸­)</h3>
                 {% if bid_projects %}
                    <table class="table-styled">
                        <thead>
                            <tr>
                                <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                                <th>å§”è¨—äºº</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in bid_projects %}
                            <tr>
                                <td>{{ project.title }}</td>
                                <td>{{ project.client_name }}</td>
                                <td>
                                    <a href="{{ url_for('get_contractor_project_details', project_id=project.id) }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>ä½ ç›®å‰æ²’æœ‰ä»»ä½•å¯©æ ¸ä¸­çš„ææ¡ˆã€‚</p>
                {% endif %}
            </div>
            
            <div class="content-box">
                <h3>æˆ‘æœªå¾—æ¨™çš„æ¡ˆå­</h3>
                 {% if lost_projects %}
                    <table class="table-styled">
                        <thead>
                            <tr>
                                <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                                <th>æœ€çµ‚ç‹€æ…‹</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in lost_projects %}
                            <tr>
                                <td>{{ project.title }}</td>
                                <td>
                                    <strong>æœªè¢«é¸ä¸­</strong>
                                    ({{ project.status }})
                                </td>
                                <td>
                                    <a href="{{ url_for('get_contractor_project_details', project_id=project.id) }}" class="btn btn-secondary btn-sm">æŸ¥çœ‹</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>ä½ ç›®å‰æ²’æœ‰ä»»ä½•æœªå¾—æ¨™çš„å°ˆæ¡ˆã€‚</p>
                {% endif %}
            </div>

        </div> </div> {% endblock %}