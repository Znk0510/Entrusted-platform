{% extends "layout.html" %}

{% block title %}æˆ‘çš„å°ˆæ¡ˆç®¡ç†{% endblock %}

{% block content %}

    <div class="dashboard-welcome">
        <h2>æ­¡è¿å›ä¾†ï¼Œ{{ user.username }}</h2>
        <p class="subtitle">
            æ‚¨ç›®å‰æœ‰ 
            <strong class="highlight-text">
                {{ all_projects | selectattr('status', 'in', ['open', 'in_progress', 'pending_approval']) | list | length }}
            </strong> 
            å€‹æ­£åœ¨é€²è¡Œä¸­çš„å§”è¨—å°ˆæ¡ˆ
        </p>
    </div>

    <div class="stats-overview-row">
        <a href="{{ url_for('get_client_dashboard') }}?status=open" 
           class="overview-card card-blue clickable-card {{ 'active-filter' if current_filter == 'open' else '' }}">
            <div class="stat-label" style="color:#1976d2;">é–‹æ”¾ææ¡ˆä¸­</div>
            <div class="stat-number" style="color:#333;">
                {{ all_projects | selectattr('status', 'equalto', 'open') | list | length }}
            </div>
        </a>

        <a href="{{ url_for('get_client_dashboard') }}?status=in_progress" 
           class="overview-card card-orange clickable-card {{ 'active-filter' if current_filter == 'in_progress' else '' }}">
            <div class="stat-label" style="color:#e65100;">åŸ·è¡Œè£½ä½œä¸­</div>
            <div class="stat-number" style="color:#333;">
                {{ all_projects | selectattr('status', 'equalto', 'in_progress') | list | length }}
            </div>
        </a>

        <a href="{{ url_for('get_client_dashboard') }}?status=pending_approval" 
           class="overview-card card-yellow clickable-card {{ 'active-filter' if current_filter == 'pending_approval' else '' }}">
            <div class="stat-label" style="color:#fbc02d;">ç­‰å¾…é©—æ”¶</div>
            <div class="stat-number" style="color:#333;">
                {{ all_projects | selectattr('status', 'equalto', 'pending_approval') | list | length }}
            </div>
        </a>

        <a href="{{ url_for('get_client_dashboard') }}?status=completed" 
           class="overview-card card-gray clickable-card {{ 'active-filter' if current_filter == 'completed' else '' }}">
            <div class="stat-label" style="color:#616161;">ç´¯è¨ˆå·²çµæ¡ˆ</div>
            <div class="stat-number" style="color:#333;">
                {{ all_projects | selectattr('status', 'equalto', 'completed') | list | length }}
            </div>
        </a>
    </div>

    <div class="client-dashboard-grid">
        
        <div class="main-list-area">
            <div class="project-list-container">
                <div class="list-header">
                    <h3>
                        {% if current_filter == 'open' %} ğŸ“‚ é–‹æ”¾ä¸­çš„å°ˆæ¡ˆ
                        {% elif current_filter == 'in_progress' %} ğŸ”¨ åŸ·è¡Œä¸­çš„å°ˆæ¡ˆ
                        {% elif current_filter == 'pending_approval' %} â±ï¸ ç­‰å¾…é©—æ”¶çš„å°ˆæ¡ˆ
                        {% elif current_filter == 'completed' %} ğŸ† å·²çµæ¡ˆçš„å°ˆæ¡ˆ
                        {% else %} æˆ‘çš„å§”è¨—åˆ—è¡¨ {% endif %}
                    </h3>
                    <span class="badge-count">å…± {{ projects|length }} ç­†</span>
                </div>

                <div class="list-body">
                    {% if projects %}
                        {% for project in projects %}
                        <div class="project-item">
                            <div class="project-main-info">
                                <div class="project-title-row">
                                    <h4 class="project-name">{{ project.title }}</h4>
                                    {% if project.status == 'open' %}
                                        <span class="status-badge-sm badge-blue">é–‹æ”¾ææ¡ˆ</span>
                                    {% elif project.status == 'in_progress' %}
                                        <span class="status-badge-sm badge-orange">åŸ·è¡Œä¸­</span>
                                    {% elif project.status == 'pending_approval' %}
                                        <span class="status-badge-sm badge-yellow">å¾…é©—æ”¶</span>
                                    {% elif project.status == 'rejected' %}
                                        <span class="status-badge-sm badge-red">å·²é€€ä»¶</span>
                                    {% elif project.status == 'completed' %}
                                        <span class="status-badge-sm badge-gray">å·²çµæ¡ˆ</span>
                                    {% endif %}
                                </div>
                                <div class="project-meta-row">
                                    <span>ğŸ“… {{ project.created_at.strftime('%Y/%m/%d') }}</span>
                                    <span class="divider">|</span>
                                    <span>{{ project.proposal_count }} ææ¡ˆ</span>
                                </div>
                            </div>
                            
                            <div class="project-action">
                                <a href="{{ url_for('get_project_details', project_id=project.id) }}" class="btn btn-secondary btn-sm">
                                    æŸ¥çœ‹è©³æƒ…
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-list-state">
                            <div class="empty-icon">
                                {% if current_filter == 'completed' %} ğŸƒ
                                {% elif current_filter == 'in_progress' %} â˜•
                                {% else %} ğŸ“­ {% endif %}
                            </div>
                            <p>æ­¤ç‹€æ…‹ä¸‹ç›®å‰æ²’æœ‰å°ˆæ¡ˆ</p>
                            {% if current_filter == 'open' %}
                                <a href="{{ url_for('get_create_project_page') }}" class="btn-text">ç«‹å³å»ºç«‹æ–°å§”è¨— &rarr;</a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="side-action-area">
            
            <div class="project-list-container">
                <div class="list-header">
                    <h3>ğŸ’¡ å¿«é€Ÿè¡Œå‹•</h3>
                </div>
                <div class="list-body" style="padding: 25px; text-align: center;">
                    <p style="color: #666; font-size: 0.95em; margin-bottom: 20px; line-height: 1.5;">
                        ç°¡å–®æè¿°æƒ³æ³•ï¼Œç‚ºæ‚¨åª’åˆå°ˆæ¥­äººæ‰ã€‚
                    </p>
                    <a href="{{ url_for('get_create_project_page') }}" class="btn btn-primary btn-block">
                        + ç™¼å¸ƒæ–°å§”è¨—
                    </a>
                </div>
            </div>

            <div class="project-list-container">
                <div class="list-header">
                    <h3>æ–°æ‰‹æŒ‡å—</h3>
                </div>
                
                <div class="list-body scrollable-list-body">
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ğŸ‘‰ å¦‚ä½•æ’°å¯«å¥½çš„éœ€æ±‚æè¿°ï¼Ÿ</span>
                            <span class="accordion-arrow">&rsaquo;</span>
                        </div>
                        <div class="accordion-content">
                            <p>ä¸€å€‹å¥½çš„éœ€æ±‚æè¿°èƒ½å¸å¼•æ›´å°ˆæ¥­çš„ææ¡ˆã€‚å»ºè­°åŒ…å«ï¼š</p>
                            <ul>
                                <li><strong>å°ˆæ¡ˆèƒŒæ™¯ï¼š</strong>ç‚ºä»€éº¼è¦åšé€™å€‹ï¼Ÿç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ</li>
                                <li><strong>å…·é«”åŠŸèƒ½ï¼š</strong>ä¾‹å¦‚ã€Œæœƒå“¡ç™»å…¥ã€ã€ã€Œè³¼ç‰©è»Šã€ã€ã€Œè‡ªå‹•ç™¼ä¿¡ã€ç­‰ã€‚</li>
                                <li><strong>é¢¨æ ¼åƒè€ƒï¼š</strong>é™„ä¸Šæ‚¨å–œæ­¡çš„ç¶²ç«™æˆ–è¨­è¨ˆåœ–é€£çµã€‚</li>
                                <li><strong>é ç®—èˆ‡æ™‚ç¨‹ï¼š</strong>æ˜ç¢ºçš„ç¯„åœèƒ½æ¸›å°‘æºé€šæˆæœ¬ã€‚</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ğŸ‘‰ é©—æ”¶éšæ®µçš„æ³¨æ„äº‹é …</span>
                            <span class="accordion-arrow">&rsaquo;</span>
                        </div>
                        <div class="accordion-content">
                            <p>é©—æ”¶æ˜¯å°ˆæ¡ˆæœ€é‡è¦çš„ç’°ç¯€ï¼Œè«‹å‹™å¿…ç¢ºèªï¼š</p>
                            <ul>
                                <li><strong>åŠŸèƒ½æ¸¬è©¦ï¼š</strong>æ‰€æœ‰åŠŸèƒ½æ˜¯å¦å¦‚é æœŸé‹ä½œï¼Ÿ</li>
                                <li><strong>è·¨è£ç½®æª¢è¦–ï¼š</strong>åœ¨æ‰‹æ©Ÿã€å¹³æ¿ã€é›»è…¦ä¸Šé¡¯ç¤ºæ˜¯å¦æ­£å¸¸ï¼Ÿ</li>
                                <li><strong>äº¤ä»˜ç‰©æª¢æŸ¥ï¼š</strong>æ˜¯å¦æ”¶åˆ°åŸå§‹ç¢¼ã€è¨­è¨ˆåŸå§‹æª”æˆ–æ“ä½œæ‰‹å†Šï¼Ÿ</li>
                            </ul>
                            <p style="margin-top:5px; color:#d9534f;">è‹¥æœ‰å•é¡Œï¼Œè«‹ä½¿ç”¨ã€Œé€€ä»¶ä¿®æ”¹ã€åŠŸèƒ½ä¸¦å…·é«”èªªæ˜åŸå› ã€‚</p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ğŸ‘‰ å¹³å°ä»˜æ¬¾èˆ‡ä¿éšœæ©Ÿåˆ¶</span>
                            <span class="accordion-arrow">&rsaquo;</span>
                        </div>
                        <div class="accordion-content">
                            <p>æœ¬å¹³å°æ¡ç”¨<strong>ç¬¬ä¸‰æ–¹è¨—ç®¡</strong>æ©Ÿåˆ¶ä¿éšœé›™æ–¹ï¼š</p>
                            <ol style="padding-left: 20px; margin-top: 10px;">
                                <li>ç™¼æ¡ˆæ™‚ï¼Œæ¬¾é …æœƒå…ˆç”±å¹³å°æš«å­˜ã€‚</li>
                                <li>å°ˆæ¡ˆé€²è¡Œä¸­ï¼Œæ¬¾é …å®‰å…¨ä¿ç•™ã€‚</li>
                                <li>å¾…æ‚¨é»æ“Š<strong>ã€Œé©—æ”¶é€šéã€</strong>å¾Œï¼Œæ¬¾é …æ‰æœƒæ’¥çµ¦æ¥æ¡ˆäººã€‚</li>
                            </ol>
                            <p style="margin-top:5px;">è‹¥ç™¼ç”Ÿçˆ­è­°ï¼Œå¯ç”³è«‹å¹³å°ä»‹å…¥ä»²è£ã€‚</p>
                        </div>
                    </div>

                </div>
            </div>

        </div>

    </div>

    <script>
        function toggleAccordion(header) {
            const item = header.parentElement;
            
            // é¸æ“‡æ€§çš„åŠŸèƒ½ï¼šè‹¥æƒ³è¦ã€Œé»é–‹ä¸€å€‹å°±é—œé–‰å…¶ä»–ã€ï¼ŒæŠŠä¸‹é¢é€™æ®µè¨»è§£æ‹¿æ‰
            
            const allItems = document.querySelectorAll('.accordion-item');
            allItems.forEach(i => {
                if (i !== item) i.classList.remove('active');
            });
            

            // åˆ‡æ›ç•¶å‰é …ç›®çš„ç‹€æ…‹
            item.classList.toggle('active');
        }
    </script>
{% endblock %}